@model List<job_portal_system.Models.Domain.Notification>
@{
    ViewData["Title"] = "Notifications";
}

<div class="container-fluid px-4 py-4">
    <div class="row">
        <div class="col-12">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
       <div>
          <h1 class="h2 mb-1">
   <i class="bi bi-bell-fill"></i> Notifications
             </h1>
<p class="text-muted mb-0">Stay updated with all your notifications</p>
         </div>
    <button id="markAllReadBtn" class="btn btn-primary">
     <i class="bi bi-check-all"></i> Mark All as Read
      </button>
  </div>

    <!-- Notifications List -->
            <div class="card shadow-sm" style="background: #161b22; border: 1px solid #30363d;">
   <div class="card-body p-0">
   @if (Model != null && Model.Any())
   {
            <div class="list-group list-group-flush">
      @foreach (var notification in Model)
     {
  <div class="list-group-item @(!notification.IsRead ? "unread-notification" : "")" 
        style="background: @(!notification.IsRead ? "rgba(56, 139, 253, 0.1)" : "#161b22"); border-color: #30363d; cursor: pointer;"
          data-id="@notification.Id"
    onclick="handleNotificationClick(@notification.Id, '@notification.ActionUrl')">
         <div class="d-flex align-items-start gap-3">
  <div class="notification-icon" style="font-size: 1.5rem;">
     @switch (notification.Type)
        {
           case job_portal_system.Models.Domain.NotificationType.NewUser:
  <i class="bi bi-person-plus-fill text-success"></i>
       break;
 case job_portal_system.Models.Domain.NotificationType.NewJobPost:
    <i class="bi bi-briefcase-fill text-primary"></i>
              break;
       case job_portal_system.Models.Domain.NotificationType.NewApplication:
        <i class="bi bi-file-earmark-text-fill text-info"></i>
   break;
  case job_portal_system.Models.Domain.NotificationType.JobApplicationReceived:
            <i class="bi bi-envelope-check-fill text-success"></i>
       break;
     case job_portal_system.Models.Domain.NotificationType.ApplicationWithdrawn:
     <i class="bi bi-x-circle-fill text-warning"></i>
 break;
   case job_portal_system.Models.Domain.NotificationType.NewJobPosted:
         <i class="bi bi-briefcase-fill text-primary"></i>
           break;
 case job_portal_system.Models.Domain.NotificationType.ApplicationStatusChanged:
      <i class="bi bi-arrow-repeat text-info"></i>
   break;
  case job_portal_system.Models.Domain.NotificationType.ApplicationAccepted:
       <i class="bi bi-check-circle-fill text-success"></i>
        break;
        case job_portal_system.Models.Domain.NotificationType.ApplicationRejected:
               <i class="bi bi-x-circle-fill text-danger"></i>
break;
       default:
            <i class="bi bi-bell-fill text-secondary"></i>
       break;
         }
      </div>
    <div class="flex-grow-1">
         <div class="d-flex justify-content-between align-items-start mb-1">
        <h6 class="mb-0 text-light">@notification.Title</h6>
       @if (!notification.IsRead)
     {
    <span class="badge bg-primary">New</span>
            }
              </div>
         <p class="mb-2 text-muted" style="font-size: 0.9rem;">@notification.Message</p>
      <small class="text-muted">
 <i class="bi bi-clock"></i>
       @{
           var timeSpan = DateTime.Now - notification.CreatedAt;
    var timeAgo = timeSpan.TotalMinutes < 1 ? "Just now" :
            timeSpan.TotalHours < 1 ? $"{(int)timeSpan.TotalMinutes} min ago" :
             timeSpan.TotalDays < 1 ? $"{(int)timeSpan.TotalHours} hr ago" :
 timeSpan.TotalDays < 7 ? $"{(int)timeSpan.TotalDays} days ago" :
      notification.CreatedAt.ToString("MMM dd, yyyy");
         }
     @timeAgo
         </small>
    </div>
  </div>
  </div>
              }
       </div>
  }
         else
      {
         <div class="text-center py-5">
  <i class="bi bi-bell-slash" style="font-size: 4rem; color: #6c757d;"></i>
   <h5 class="mt-3 text-muted">No notifications yet</h5>
       <p class="text-muted">You'll see notifications here when you have updates</p>
     </div>
         }
  </div>
          </div>
        </div>
    </div>
</div>

<style>
 .unread-notification {
        border-left: 4px solid #388bfd !important;
    }
</style>

@section Scripts {
    <script>
        async function handleNotificationClick(notificationId, actionUrl) {
            try {
          await fetch(`/Notification/MarkAsRead?id=${notificationId}`, {
         method: 'POST'
            });

        // Remove visual unread indicator
            const notification = document.querySelector(`[data-id="${notificationId}"]`);
        if (notification) {
       notification.classList.remove('unread-notification');
         notification.style.background = '#161b22';
        const badge = notification.querySelector('.badge');
         if (badge) badge.remove();
          }

    // Navigate if URL is provided
      if (actionUrl && actionUrl !== '' && actionUrl !== 'null') {
                window.location.href = actionUrl;
  }
         } catch (error) {
    console.error("Error marking notification as read:", error);
  }
        }

 document.getElementById('markAllReadBtn')?.addEventListener('click', async function() {
     try {
 await fetch('/Notification/MarkAllAsRead', {
   method: 'POST'
           });

    // Update UI
         document.querySelectorAll('.unread-notification').forEach(notification => {
           notification.classList.remove('unread-notification');
    notification.style.background = '#161b22';
   const badge = notification.querySelector('.badge');
        if (badge) badge.remove();
    });

   // Show success message
  this.innerHTML = '<i class="bi bi-check-circle-fill"></i> All Read';
    setTimeout(() => {
   this.innerHTML = '<i class="bi bi-check-all"></i> Mark All as Read';
     }, 2000);
            } catch (error) {
           console.error("Error marking all as read:", error);
         }
  });
    </script>
}
